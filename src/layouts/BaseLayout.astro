---
import { ViewTransitions } from 'astro:transitions';
import Navigation from '../components/Navigation.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
  image?: string;
  article?: boolean;
}

const {
  title,
  description = 'Adelaide-based Old School D&D, OSR, and NSR gaming blog featuring resources, tools, campaign reports, and community content from Australia',
  image = '/favicon.svg',
  article = false,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const socialImage = new URL(image, Astro.site);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <link rel="canonical" href={canonicalURL} />
    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/rss.xml" />

    <ViewTransitions />

    <script is:inline>
      // Set theme immediately to prevent flash of wrong theme
      function applyTheme() {
        const getTheme = () => {
          if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
            return localStorage.getItem('theme');
          }
          if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            return 'topo-dark';
          }
          return 'topo-light';
        };

        const theme = getTheme();
        document.documentElement.setAttribute('data-theme', theme);
      }

      // Apply theme on initial load
      applyTheme();

      // Re-apply theme after view transitions
      document.addEventListener('astro:after-swap', applyTheme);
    </script>

    <title>{title}</title>

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content={article ? 'article' : 'website'} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image" content={socialImage} />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={socialImage} />
  </head>
  <body class="bg-base-200">
    <Navigation />
    <main class="min-h-screen">
      <slot />
    </main>
    <footer class="footer footer-center p-10 bg-base-300 text-base-content mt-12">
      <aside>
        <p class="font-bold">
          Dungeons and Datums
        </p>
        <p>Old School D&D, OSR & NSR gaming in Adelaide, Australia</p>
        <p>Copyright Â© {new Date().getFullYear()} - All rights reserved</p>
      </aside>
    </footer>
  </body>
</html>
