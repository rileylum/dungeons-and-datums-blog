---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogCard from '../../components/blog/BlogCard.astro';
import Pagination from '../../components/blog/Pagination.astro';
import { getPublishedPosts } from '../../utils/blog';

export async function getStaticPaths() {
  const postsPerPage = 10;
  const allPosts = await getPublishedPosts();
  const totalPages = Math.ceil(allPosts.length / postsPerPage);

  return Array.from({ length: totalPages - 1 }, (_, i) => {
    const pageNum = i + 2;
    const start = (pageNum - 1) * postsPerPage;
    const end = start + postsPerPage;

    return {
      params: { page: pageNum.toString() },
      props: {
        posts: allPosts.slice(start, end),
        currentPage: pageNum,
        totalPages,
      },
    };
  });
}

const { posts, currentPage, totalPages } = Astro.props;
---

<BaseLayout
  title={`Page ${currentPage} - Dungeons and Datums`}
  description="A blog about dungeons and datums"
>
  <div class="max-w-4xl mx-auto px-4 py-8">
    <header class="mb-12 text-center">
      <h1 class="text-5xl font-bold mb-4">Dungeons and Datums</h1>
      <p class="text-xl text-base-content/70">
        Exploring the intersection of role-playing games and data science
      </p>
    </header>

    <div class="flex flex-col gap-6 mb-12">
      {posts.map((post) => <BlogCard post={post} />)}
    </div>

    <div class="flex justify-center">
      <Pagination
        currentPage={currentPage}
        totalPages={totalPages}
        baseUrl="/"
      />
    </div>
  </div>
</BaseLayout>
